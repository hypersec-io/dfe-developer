---
# Verification tasks - check that key tools are installed and working
# Run as post_tasks in main playbook

- name: Verify Docker installation
  ansible.builtin.command: docker --version
  register: docker_version
  changed_when: false
  failed_when: docker_version.rc != 0

- name: Verify kubectl installation
  ansible.builtin.command: kubectl version --client
  register: kubectl_version
  changed_when: false
  failed_when: kubectl_version.rc != 0

- name: Verify Git installation
  ansible.builtin.command: git --version
  register: git_version
  changed_when: false
  failed_when: git_version.rc != 0

- name: Verify UV installation
  ansible.builtin.command: "{{ dfe_user_home }}/.cargo/bin/uv --version"
  register: uv_version
  changed_when: false
  failed_when: uv_version.rc != 0
  become: false
  become_user: "{{ dfe_actual_user }}"

- name: Verify AWS CLI installation
  ansible.builtin.command: aws --version
  register: aws_version
  changed_when: false
  failed_when: aws_version.rc != 0

- name: Display verification results
  ansible.builtin.debug:
    msg: |
      âœ… Verification Complete:
      - Docker: {{ docker_version.stdout }}
      - kubectl: {{ kubectl_version.stdout | regex_search('v[0-9.]+') }}
      - Git: {{ git_version.stdout }}
      - UV: {{ uv_version.stdout }}
      - AWS CLI: {{ aws_version.stdout }}
