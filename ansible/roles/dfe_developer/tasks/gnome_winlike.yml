---
# Windows-like GNOME Shell configuration
# Uses ui-mode utility to configure Dash to Panel for a Windows-style taskbar
#
# Extensions enabled:
# - Dash to Panel: Windows-style taskbar at bottom with Show Applications button
# - Window State Manager: Remember/restore window positions across sessions
# - System Monitor: CPU/Memory in panel

# ============================================================================
# COMMON PREREQUISITES (gext, all extensions, ui-mode utility)
# ============================================================================

- name: Install common GNOME prerequisites and all extensions
  ansible.builtin.include_tasks: gnome_common.yml

# ============================================================================
# APPLY WINLIKE MODE VIA UI-MODE UTILITY
# ============================================================================

- name: Apply Windows-like UI mode
  ansible.builtin.command:
    cmd: /usr/local/sbin/ui-mode winlike
  become: true
  become_user: "{{ dfe_actual_user }}"
  changed_when: true

# ============================================================================
# WALLPAPER DEPLOYMENT (system-wide, safe from apt/dnf updates)
# ============================================================================

- name: Create local backgrounds directory (safe from package updates)
  ansible.builtin.file:
    path: /usr/local/share/backgrounds
    state: directory
    mode: '0755'

- name: Deploy DFE background image
  ansible.builtin.copy:
    src: dfe-background.svg
    dest: /usr/local/share/backgrounds/dfe-background.svg
    mode: '0644'

- name: Set DFE background as default (light mode)
  community.general.dconf:
    key: "/org/gnome/desktop/background/picture-uri"
    value: "'file:///usr/local/share/backgrounds/dfe-background.svg'"
    state: present
  become: false

- name: Set DFE background as default (dark mode)
  community.general.dconf:
    key: "/org/gnome/desktop/background/picture-uri-dark"
    value: "'file:///usr/local/share/backgrounds/dfe-background.svg'"
    state: present
  become: false

- name: Set background scaling mode
  community.general.dconf:
    key: "/org/gnome/desktop/background/picture-options"
    value: "'zoom'"
    state: present
  become: false

# ============================================================================
# UPDATE ALL EXTENSIONS TO LATEST
# ============================================================================

- name: Update all installed extensions to latest versions
  ansible.builtin.command:
    cmd: "{{ dfe_user_home }}/.local/bin/gext -F update"
  become: true
  become_user: "{{ dfe_actual_user }}"
  changed_when: false
  failed_when: false
