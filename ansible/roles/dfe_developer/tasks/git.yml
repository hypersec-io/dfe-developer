---
# Git and version control tools installation

# Fedora - Enable git-maint COPR for latest Git
- name: Enable git-maint COPR for latest Git (Fedora)
  community.general.copr:
    name: '@git-maint/git'
    state: enabled
  when: ansible_distribution == 'Fedora'

- name: Install latest Git from COPR (Fedora)
  ansible.builtin.dnf:
    name:
      - git
      - git-lfs
    state: latest
  when: ansible_distribution == 'Fedora'

# Ubuntu - Add git-core PPA for latest version
- name: Add git-core PPA for latest Git (Ubuntu)
  ansible.builtin.apt_repository:
    repo: ppa:git-core/ppa
    state: present
  when: ansible_distribution == 'Ubuntu'

- name: Install latest Git from PPA (Ubuntu)
  ansible.builtin.apt:
    name:
      - git
      - git-lfs
    state: latest
    update_cache: true
  when: ansible_distribution == 'Ubuntu'

# macOS - Homebrew provides latest
- name: Install latest Git (macOS)
  community.general.homebrew:
    name:
      - git
      - git-lfs
    state: latest
  when: ansible_distribution == 'MacOSX'

# Install GitHub CLI
- name: Install GitHub CLI (Fedora)
  ansible.builtin.dnf:
    name: gh
    state: present
  when: ansible_distribution == 'Fedora'

- name: Install GitHub CLI (Ubuntu)
  ansible.builtin.apt:
    name: gh
    state: present
  when: ansible_distribution == 'Ubuntu'

- name: Install GitHub CLI (macOS)
  community.general.homebrew:
    name: gh
    state: present
  when: ansible_distribution == 'MacOSX'

# Configure Git LFS
- name: Install Git LFS hooks
  ansible.builtin.command: git lfs install
  become: false
  changed_when: false
  failed_when: false
