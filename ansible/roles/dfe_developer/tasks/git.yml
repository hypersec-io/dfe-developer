---
# Git and version control tools installation

# ============================================================================
# FEDORA - Latest Git from COPR
# ============================================================================

- name: Install latest Git (Fedora)
  block:
    - name: Enable git-maint COPR
      community.general.copr:
        name: '@git-maint/git'
        state: enabled

    - name: Install Git and Git LFS
      ansible.builtin.dnf:
        name:
          - git
          - git-lfs
        state: latest

  when: ansible_distribution == 'Fedora'

# ============================================================================
# UBUNTU - Latest Git from PPA
# ============================================================================

- name: Install latest Git (Ubuntu)
  block:
    - name: Add git-core PPA
      ansible.builtin.apt_repository:
        repo: ppa:git-core/ppa
        state: present

    - name: Install Git and Git LFS
      ansible.builtin.apt:
        name:
          - git
          - git-lfs
        state: latest
        update_cache: true

  when: ansible_distribution == 'Ubuntu'

# ============================================================================
# macOS - Latest Git from Homebrew
# ============================================================================

- name: Install latest Git (macOS)
  community.general.homebrew:
    name:
      - git
      - git-lfs
    state: latest
  become: false
  environment: "{{ homebrew_env }}"
  when: ansible_distribution == 'MacOSX'

# ============================================================================
# GITHUB CLI (all platforms)
# ============================================================================

- name: Install GitHub CLI (Fedora)
  ansible.builtin.dnf:
    name: gh
    state: present
  when: ansible_distribution == 'Fedora'

- name: Install GitHub CLI (Ubuntu)
  ansible.builtin.apt:
    name: gh
    state: present
  when: ansible_distribution == 'Ubuntu'

- name: Install GitHub CLI (macOS)
  community.general.homebrew:
    name: gh
    state: present
  become: false
  environment: "{{ homebrew_env }}"
  when: ansible_distribution == 'MacOSX'

# ============================================================================
# CONFIGURE GIT LFS (all platforms, user-level)
# ============================================================================

- name: Install Git LFS hooks
  ansible.builtin.command: git lfs install
  become: false
  changed_when: false
  failed_when: false
