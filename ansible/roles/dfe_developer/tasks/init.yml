---
# Bootstrap tasks - run once at the start
# Sets up common variables used across all tasks

- name: Detect actual user (for sudo operations)
  ansible.builtin.set_fact:
    dfe_actual_user: "{{ ansible_env.SUDO_USER | default(ansible_user_id, true) }}"

- name: Set actual user home directory
  ansible.builtin.set_fact:
    dfe_user_home: "{{ '/home/' + dfe_actual_user if dfe_actual_user != 'root' else '/root' }}"

- name: Display user information
  ansible.builtin.debug:
    msg: "Installing for user: {{ dfe_actual_user }} (home: {{ dfe_user_home }})"

- name: Detect if GNOME is running
  ansible.builtin.command: pgrep -x gnome-shell
  register: gnome_running_check
  failed_when: false
  changed_when: false

- name: Set GNOME availability fact
  ansible.builtin.set_fact:
    dfe_has_gnome: "{{ gnome_running_check.rc == 0 }}"

- name: Display GNOME status
  ansible.builtin.debug:
    msg: "GNOME desktop: {{ 'Detected' if dfe_has_gnome else 'Not detected' }}"
