---
# GenAI Toolbox (MCP Toolbox) - Google's AI tooling

# ============================================================================
# MACOS - Install via Homebrew
# ============================================================================

- name: Install MCP Toolbox (macOS)
  community.general.homebrew:
    name: mcp-toolbox
    state: present
  become: false
  environment: "{{ homebrew_env }}"
  when: ansible_distribution == 'MacOSX'

# ============================================================================
# LINUX - Install via binary from Google Cloud Storage
# ============================================================================

- name: Install MCP Toolbox (Linux)
  block:
    - name: Get latest MCP Toolbox version from GitHub API
      ansible.builtin.uri:
        url: https://api.github.com/repos/googleapis/genai-toolbox/releases/latest
        return_content: true
      register: toolbox_release

    - name: Set MCP Toolbox version fact
      ansible.builtin.set_fact:
        toolbox_version: "{{ toolbox_release.json.tag_name }}"

    - name: Download MCP Toolbox binary
      ansible.builtin.get_url:
        url: "https://storage.googleapis.com/genai-toolbox/{{ toolbox_version }}/linux/amd64/toolbox"
        dest: /usr/local/bin/toolbox
        mode: '0755'

  when: ansible_distribution in ['Fedora', 'Ubuntu']
