---
# Verification - Core developer tools

- name: Verify JFrog CLI (Linux)
  ansible.builtin.command: jf --version
  register: verify_jfrog
  changed_when: false
  failed_when: verify_jfrog.rc != 0
  when: ansible_distribution in ['Fedora', 'Ubuntu']

- name: Verify JFrog CLI (macOS)
  ansible.builtin.command: jf --version
  environment: "{{ homebrew_env }}"
  register: verify_jfrog
  changed_when: false
  failed_when: verify_jfrog.rc != 0
  when: ansible_distribution == 'MacOSX'

- name: Verify Azure CLI (Linux)
  ansible.builtin.command: az version
  register: verify_azure
  changed_when: false
  failed_when: verify_azure.rc != 0
  when: ansible_distribution in ['Fedora', 'Ubuntu']

- name: Verify Azure CLI (macOS)
  ansible.builtin.command: az version
  environment: "{{ homebrew_env }}"
  register: verify_azure
  changed_when: false
  failed_when: verify_azure.rc != 0
  when: ansible_distribution == 'MacOSX'

- name: Verify Node.js (Linux)
  ansible.builtin.command: node --version
  register: verify_node
  changed_when: false
  failed_when: verify_node.rc != 0
  when: ansible_distribution in ['Fedora', 'Ubuntu']

- name: Verify Node.js (macOS)
  ansible.builtin.command: node --version
  environment: "{{ homebrew_env }}"
  register: verify_node
  changed_when: false
  failed_when: verify_node.rc != 0
  when: ansible_distribution == 'MacOSX'

- name: Verify semantic-release
  ansible.builtin.command: "{{ dfe_user_home }}/.npm-global/bin/semantic-release --version"
  register: verify_semrel
  changed_when: false
  failed_when: verify_semrel.rc != 0
  become: false

- name: Verify Linear CLI
  ansible.builtin.command: "linear --version"
  register: verify_linear
  changed_when: false
  failed_when: verify_linear.rc != 0
  become: false

- name: Verify OpenVPN 3 (Linux)
  ansible.builtin.command: openvpn3 version
  register: verify_openvpn
  changed_when: false
  failed_when: verify_openvpn.rc != 0
  when: ansible_distribution in ['Fedora', 'Ubuntu']

- name: Verify OpenVPN 3 (macOS)
  ansible.builtin.command: openvpn --version
  environment: "{{ homebrew_env }}"
  register: verify_openvpn
  changed_when: false
  failed_when: verify_openvpn.rc != 0
  when: ansible_distribution == 'MacOSX'

- name: Verify Claude Code CLI
  ansible.builtin.command: "{{ dfe_user_home }}/.npm-global/bin/claude --version"
  register: verify_claude
  changed_when: false
  failed_when: verify_claude.rc != 0
  become: false

- name: Verify Gitleaks (Linux)
  ansible.builtin.command: gitleaks version
  register: verify_gitleaks
  changed_when: false
  failed_when: verify_gitleaks.rc != 0
  when: ansible_distribution in ['Fedora', 'Ubuntu']

- name: Verify Gitleaks (macOS)
  ansible.builtin.command: gitleaks version
  environment: "{{ homebrew_env }}"
  register: verify_gitleaks
  changed_when: false
  failed_when: verify_gitleaks.rc != 0
  when: ansible_distribution == 'MacOSX'

- name: Verify MCP Toolbox (Linux)
  ansible.builtin.command: toolbox --version
  register: verify_toolbox
  changed_when: false
  failed_when: verify_toolbox.rc != 0
  when: ansible_distribution in ['Fedora', 'Ubuntu']

- name: Verify MCP Toolbox (macOS)
  ansible.builtin.command: toolbox --version
  environment: "{{ homebrew_env }}"
  register: verify_toolbox
  changed_when: false
  failed_when: verify_toolbox.rc != 0
  when: ansible_distribution == 'MacOSX'

- name: Display core tools verification
  ansible.builtin.debug:
    msg: |
      âœ… Core Developer Tools Verified:
      - JFrog CLI: {{ verify_jfrog.stdout | default('installed') }}
      - Azure CLI: {{ verify_azure.stdout | default('installed') }}
      - Node.js: {{ verify_node.stdout | default('installed') }}
      - semantic-release: {{ verify_semrel.stdout | default('installed') }}
      - Linear CLI: {{ verify_linear.stdout | default('installed') }}
      - OpenVPN: {{ verify_openvpn.stdout | default('installed') }}
      - Claude Code CLI: {{ verify_claude.stdout | default('installed') }}
      - Gitleaks: {{ verify_gitleaks.stdout | default('installed') }}
      - MCP Toolbox: {{ verify_toolbox.stdout | default('installed') }}
