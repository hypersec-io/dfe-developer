---
# OnlyOffice and Mailspring installation (Linux only, system-wide via Flatpak)

# ============================================================================
# ONLYOFFICE DESKTOP EDITORS
# ============================================================================

- name: Install OnlyOffice via Flatpak (system-wide)
  community.general.flatpak:
    name: org.onlyoffice.desktopeditors
    state: present
    method: system
  when:
    - ansible_facts['distribution'] in ['Fedora', 'Ubuntu']
    - dfe_has_gnome | default(false)

# Set OnlyOffice as default for common document types
- name: Set OnlyOffice as default for office documents
  ansible.builtin.command:
    cmd: "xdg-mime default org.onlyoffice.desktopeditors.desktop {{ item }}"
  loop:
    # Word documents
    - application/msword
    - application/vnd.openxmlformats-officedocument.wordprocessingml.document
    - application/vnd.oasis.opendocument.text
    # Excel spreadsheets
    - application/vnd.ms-excel
    - application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
    - application/vnd.oasis.opendocument.spreadsheet
    # PowerPoint presentations
    - application/vnd.ms-powerpoint
    - application/vnd.openxmlformats-officedocument.presentationml.presentation
    - application/vnd.oasis.opendocument.presentation
  become: true
  become_user: "{{ dfe_actual_user }}"
  changed_when: true
  failed_when: false
  when:
    - ansible_facts['distribution'] in ['Fedora', 'Ubuntu']
    - dfe_has_gnome | default(false)

# ============================================================================
# MAILSPRING EMAIL CLIENT
# ============================================================================

- name: Install Mailspring via Flatpak (system-wide)
  community.general.flatpak:
    name: com.getmailspring.Mailspring
    state: present
    method: system
  when:
    - ansible_facts['distribution'] in ['Fedora', 'Ubuntu']
    - dfe_has_gnome | default(false)

# Set Mailspring as default email client
- name: Set Mailspring as default email client
  ansible.builtin.command:
    cmd: xdg-mime default com.getmailspring.Mailspring.desktop x-scheme-handler/mailto
  become: true
  become_user: "{{ dfe_actual_user }}"
  changed_when: true
  failed_when: false
  when:
    - ansible_facts['distribution'] in ['Fedora', 'Ubuntu']
    - dfe_has_gnome | default(false)
