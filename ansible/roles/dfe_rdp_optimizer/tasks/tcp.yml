---
# TCP optimizations for RDP (low-latency, mobile-friendly)

- name: Configure TCP BBR congestion control for RDP
  ansible.posix.sysctl:
    name: "{{ item.name }}"
    value: "{{ item.value }}"
    state: present
    sysctl_file: /etc/sysctl.d/99-rdp-optimization.conf
    reload: true
  loop:
    - { name: 'net.core.default_qdisc', value: 'fq' }
    - { name: 'net.ipv4.tcp_congestion_control', value: 'bbr' }
    - { name: 'net.core.rmem_max', value: '16777216' }
    - { name: 'net.core.wmem_max', value: '16777216' }
    - { name: 'net.ipv4.tcp_rmem', value: '4096 87380 16777216' }
    - { name: 'net.ipv4.tcp_wmem', value: '4096 65536 16777216' }
    - { name: 'net.core.netdev_max_backlog', value: '5000' }
  when:
    - ansible_distribution in ['Fedora', 'Ubuntu']
    - dfe_has_gnome
